package internousdev.sub.action;
import java.util.List;
import java.util.Map;

import org.apache.struts2.interceptor.SessionAware;

import com.opensymphony.xwork2.ActionSupport;

import internousdev.sub.dao.BuyItemDAO;
import internousdev.sub.dao.LoginDAO;
import internousdev.sub.dto.BuyItemDTO;
import internousdev.sub.dto.LoginDTO;


public class LoginAction extends ActionSupport implements SessionAware{

	private String loginUserId;
	private String loginPassword;

	public Map<String, Object> session;

	private LoginDAO loginDAO = new LoginDAO();
	private LoginDTO loginDTO = new LoginDTO();

	private BuyItemDAO buyItemDAO = new BuyItemDAO();
	private BuyItemDTO buyItemDTO = new BuyItemDTO();
	private List<BuyItemDTO> buyItemDTOList;


	public String execute(){

		String result = ERROR;

		if(session.containsKey("id") || session.containsKey("masterId")){

			result = "alreadyLogged";

		}else{

			loginDTO = loginDAO.getLoginUserInfo(loginUserId, loginPassword);

			session.put("loginUser", loginDTO);


			if(((LoginDTO) session.get("loginUser")).isLoginMaster()){
				buyItemDTOList = buyItemDAO.getBuyItemInfo();
				session.put("buyItemDTOList", buyItemDTOList);
				session.put("masterId", loginUserId);
				result = "master";
			}

			if(result != "master"){

				if(((LoginDTO) session.get("loginUser")).isLoginFlg()){

					buyItemDTOList = buyItemDAO.getBuyItemInfo();
					session.put("buyItemDTOList", buyItemDTOList);
					session.put("id", buyItemDTO.getId());
					session.put("login_user_id", loginDTO.getLoginId());
					session.put("login_password", loginDTO.getLoginPass());
					session.put("userName", loginDTO.getUserName());
					session.put("userAddress", loginDTO.getUserAddress());
					session.put("userSex", loginDTO.getUserSex());
					session.put("userTell", loginDTO.getUserTell());
					session.put("userMail", loginDTO.getUserMail());

					result = SUCCESS;
				}
			}

		}return result;

	}

}
